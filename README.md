![Assertable HTML](art/logo.png)

Assertable HTML is an elegantly designed PHPUnit library that makes performing assertions on HTML responses from PHP and Laravel applications quick and enjoyable.

Here's a quick example:

```php
use Ziadoz\AssertableHtml\Dom\AssertableDocument;
use Ziadoz\AssertableHtml\Dom\AssertableElement;

// Make the response HTML an assertable document...
$html = AssertableDocument::createFromString(<<<HTML
    <h1 class="heading">Dashboard</h1>

    <nav>
        <a href="/dashboard" class="nav-link active">Dashboard</a>
        <a href="/settings" class="nav-link">Settings</a>
        <a href="/logout" class="nav-link">Logout</a>
    </nav>

    <div id="content">
        <h2 class="heading subheading">Welcome, Archie</h2>
        
        <search>
            <form method="post" action="/search">
                <!-- ... -->

                <input type="hidden" name="csrf" value="...">
                <button type="Submit">Search</button>
            </form>
        </search>
    </div>
HTML, LIBXML_NOERROR);

// Assert on the <h1> element...
$html->querySelector('h1')->assertTextEquals('Dashboard');

// Start asserting on the <nav> element...
$html->with('nav', function (AssertableElement $nav) {
    // Assert there are 3 navigation links with the correct classes... 
    $links = $nav->querySelectorAll('a')
        ->assertCount(3)
        ->assertAll(function (AssertableElement $a) {
            $a->classes->contains('nav-link');
        });

    // Assert each link has the correct URL and "active" style class...
    $links[0]->assertAttributeEquals('href', '/dashboard')
        ->assertTextEquals('Dashboard')
        ->assertClassContains('active');

    $links[1]->assertAttributeEquals('href', '/settings')
        ->assertTextEquals('Settings')
        ->assertClassDoesntContain('active');

    $links[2]->assertAttributeEquals('href', '/logout')
        ->assertTextEquals('Logout')
        ->assertClassDoesntContain('active');

    // More assertions within <nav>...
});

// Start asserting on the <div id="content"> element...
$html->with('#content', function (AssertableElement $div) {
    // Assert the sub-heading...
    $div->querySelector('h2')
        ->assertClassContainsAll(['heading', 'subheading'])
        ->assertTextContains('Welcome');

    $div->with('search form', function (AssertableElement $form) {
        // Assert the form posts to the correct endpoint...
        $form->assertAttributeEquals('method', 'post')
            ->assertAttributeStartsWith('action', '/search');
            
        // Assert there's a submit button and hidden CSRF token...
        $form->assertElementsExist('button[type="submit"]')
            ->assertElementsExist('input[type="hidden"][name="csrf"]');
    });

    // More assertions within <div id="content">...
});

```

It's cumbersome to test HTML generated by template engines such as Blade and Twig. Assertable HTML parses your web application responses as proper HTML, and provides a fluent interface to quickly write test assertions against it. 

The fluent interface API is similar, but not identical, to PHP 8.4's new HTML document parsing API, however, it's significantly simpler and stripped back to only the bits required for HTML testing.

## üì¶ Requirements

- PHP 8.4
- Composer

## üñ• Installation

You can install the package using Composer:

```bash
composer install ziadoz/assertable-html
```

If you're using Laravel, Assertable HTML will be automatically discovered. You can still register it manually if needed:

```php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Ziadoz\AssertableHtml\AssertableHtmlServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    public function register(): void
    {
        $this->app->register(AssertableHtmlServiceProvider::class);
    }
}
```

## üî® Usage

### Basics

### Assertions

### Advanced Assertions

## üëè Thanks

This package wouldn't be possible without the following people and projects:

- Rachel ‚ù§Ô∏è, Archie üê∂ and Rigby üê∂
- Niels Dossche (PHP 8.4 HTML parsing API author)
- [Lexbor](https://github.com/lexbor/lexbor) (the library that powers PHP 8.4's HTML parsing API)
